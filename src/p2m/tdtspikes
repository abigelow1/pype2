#!/usr/bin/env pypenv
# -*- Mode: Python; tab-width: 4; py-indent-offset: 4; -*-
#
# Retrieve spike timestamps from tdt datatank using network api
#

import sys
import tdtspikes

if __name__ == '__main__':
    from optparse import OptionParser
    
    p = OptionParser('usage: %prog [server/tank/block or pypefile]')
    p.add_option('-s', '--server', dest='server',
                 action='store', type='string', default=None,
                 help='tdt server computer')
    p.add_option('-t', '--tank', dest='tank',
                 action='store', type='string', default=None,
                 help='tdt data tank')
    p.add_option('-b', '--block', dest='block',
                 action='store', type='string', default=None,
                 help='tdt block name')
    
    (options, args) = p.parse_args()
    if len(args) > 0:
        # user specified a pype data file
        d = tdtspikes(pypefile=args[0])
    elif options.server and options.tank and options.block:
        d = tdtspikes(server=options.server,
                      tank=options.tank,
                      block=options.block)
    else:
        sys.stderr.write('extract from where??\n')
        sys.exit(1)
    d.dump(sys.stdout)
